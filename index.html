<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Connect 비용 계산기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Lucide icons as SVG */
        .icon {
            width: 1.25rem;
            height: 1.25rem;
            display: inline-block;
            vertical-align: middle;
        }
        .icon-lg {
            width: 2rem;
            height: 2rem;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen">
    <div class="max-w-6xl mx-auto p-6">
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <svg class="icon icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <rect width="16" height="10" x="2" y="3" rx="2"/>
                            <path d="m7 11 2-2-2-2"/>
                            <path d="m13 13 6-6"/>
                            <path d="m17 11 2 2-2 2"/>
                        </svg>
                        <div>
                            <h1 class="text-2xl font-bold">Amazon Connect 비용 계산기</h1>
                            <p class="text-blue-100">한국(서울) 리전 • AI무제한 요금제</p>
                        </div>
                    </div>
                    <!-- CSV 내보내기 버튼 -->
                    <button
                        onclick="exportToCSV()"
                        class="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-blue-50 transition-colors flex items-center gap-2"
                    >
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7,10 12,15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        CSV 내보내기
                    </button>
                </div>
            </div>

            <div class="p-6 grid lg:grid-cols-2 gap-8">
                <!-- 입력 섹션 -->
                <div class="space-y-6">
                    <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                        </svg>
                        사용량 입력
                    </h2>

                    <div class="space-y-4">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                인바운드 통화 시간 (분/월)
                            </label>
                            <input
                                type="number"
                                id="inboundMinutes"
                                value="600"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="600"
                                oninput="updateCalculations()"
                            />
                            <p class="text-xs text-gray-500 mt-1">고객이 걸어오는 통화 시간</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                아웃바운드 통화 시간 (분/월)
                            </label>
                            <input
                                type="number"
                                id="outboundMinutes"
                                value="400"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="400"
                                oninput="updateCalculations()"
                            />
                            <p class="text-xs text-gray-500 mt-1">상담원이 발신하는 통화 시간</p>
                        </div>

                        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                            <label class="block text-sm font-medium text-blue-800 mb-2">
                                총 통화 시간 (자동 계산)
                            </label>
                            <div class="text-lg font-semibold text-blue-900" id="totalMinutes">
                                1,000 분
                            </div>
                            <p class="text-xs text-blue-600 mt-1">AI무제한 음성 요금 적용 기준</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                DID 번호 개수
                            </label>
                            <input
                                type="number"
                                id="didNumbers"
                                value="2"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="2"
                                oninput="updateCalculations()"
                            />
                            <p class="text-xs text-gray-500 mt-1">일반 직통 전화번호 개수</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Toll-free 번호 개수
                            </label>
                            <input
                                type="number"
                                id="tollFreeNumbers"
                                value="1"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="1"
                                oninput="updateCalculations()"
                            />
                            <p class="text-xs text-gray-500 mt-1">수신자 부담 전화번호 개수</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                녹취 비율 (%)
                            </label>
                            <input
                                type="number"
                                max="100"
                                id="recordingPercentage"
                                value="100"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="100"
                                oninput="updateCalculations()"
                            />
                            <p class="text-xs text-gray-500 mt-1">녹취를 진행할 통화의 비율</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Toll-free 인바운드 비율 (%)
                            </label>
                            <input
                                type="number"
                                max="100"
                                id="tollFreeInboundPercentage"
                                value="30"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="30"
                                oninput="updateCalculations()"
                            />
                            <p class="text-xs text-gray-500 mt-1">인바운드 중 toll-free 번호로 받는 통화 비율</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                TTS 평균 문자수 (콜당)
                            </label>
                            <input
                                type="number"
                                id="ttsCharactersPerCall"
                                value="200"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="200"
                                oninput="updateCalculations()"
                            />
                            <p class="text-xs text-gray-500 mt-1">인바운드 1콜당 TTS로 읽어주는 평균 문자수</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                S3 저장용량 (자동 계산)
                            </label>
                            <div class="w-full px-3 py-2 bg-blue-50 border border-blue-300 rounded-md text-blue-900 font-medium" id="s3StorageCalculated">
                                5.0 GB (자동 계산됨)
                            </div>
                            <p class="text-xs text-gray-500 mt-1">통화시간 × 녹취비율 × 1MB/분 기준 자동 계산</p>
                        </div>

                        <div class="bg-yellow-50 rounded-lg p-4 border border-yellow-200">
                            <label class="block text-sm font-medium text-yellow-800 mb-2">
                                환율 (USD → KRW)
                            </label>
                            <input
                                type="number"
                                id="exchangeRate"
                                value="1350"
                                class="w-full px-3 py-2 border border-yellow-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                                placeholder="1350"
                                oninput="updateCalculations()"
                            />
                            <p class="text-xs text-yellow-600 mt-1">1달러 = ? 원 (원화 환산용)</p>
                        </div>
                    </div>
                </div>

                <!-- 결과 섹션 -->
                <div class="space-y-6">
                    <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <line x1="12" y1="1" x2="12" y2="23"/>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                        예상 월 비용
                    </h2>

                    <div class="space-y-3">
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-purple-900">전화번호 임대료</span>
                                <div class="text-right">
                                    <div class="font-semibold text-purple-900" id="numberRentalUSD">$17.99</div>
                                    <div class="text-xs text-purple-600" id="numberRentalKRW">₩24,287</div>
                                </div>
                            </div>
                            <p class="text-xs text-purple-600 mt-1" id="numberRentalDetails">
                                DID 2개 + Toll-free 1개 (월 30일 기준)
                            </p>
                        </div>

                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-blue-900">인바운드 통화료</span>
                                <div class="text-right">
                                    <div class="font-semibold text-blue-900" id="inboundTelephonyUSD">$15.60</div>
                                    <div class="text-xs text-blue-600" id="inboundTelephonyKRW">₩21,060</div>
                                </div>
                            </div>
                            <p class="text-xs text-blue-600 mt-1" id="inboundTelephonyDetails">
                                600분 × $0.002/분 (추정값)
                            </p>
                        </div>

                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-orange-900">아웃바운드 통화료</span>
                                <div class="text-right">
                                    <div class="font-semibold text-orange-900" id="outboundTelephonyUSD">$19.20</div>
                                    <div class="text-xs text-orange-600" id="outboundTelephonyKRW">₩25,920</div>
                                </div>
                            </div>
                            <p class="text-xs text-orange-600 mt-1" id="outboundTelephonyDetails">
                                400분 × $0.048/분 (한국 내)
                            </p>
                        </div>

                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-green-900">AI무제한 음성 요금</span>
                                <div class="text-right">
                                    <div class="font-semibold text-green-900" id="aiUnlimitedVoiceUSD">$38.00</div>
                                    <div class="text-xs text-green-600" id="aiUnlimitedVoiceKRW">₩51,300</div>
                                </div>
                            </div>
                            <p class="text-xs text-green-600 mt-1" id="aiUnlimitedVoiceDetails">
                                1,000분 × $0.038/분
                            </p>
                        </div>

                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-2">
                                    <span class="font-medium text-purple-900">S3 저장비용</span>
                                </div>
                                <div class="text-right">
                                    <div class="font-semibold text-purple-900" id="s3StorageUSD">$2.50</div>
                                    <div class="text-xs text-purple-600" id="s3StorageKRW">₩3,375</div>
                                </div>
                            </div>
                            <p class="text-xs text-purple-600 mt-1" id="s3StorageDetails">
                                100GB × $0.025/GB/월
                            </p>
                        </div>

                        <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-2">
                                    <svg class="icon text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/>
                                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                                        <line x1="12" y1="19" x2="12" y2="23"/>
                                        <line x1="8" y1="23" x2="16" y2="23"/>
                                    </svg>
                                    <span class="font-medium text-indigo-900">TTS (Polly)</span>
                                </div>
                                <div class="text-right">
                                    <div class="font-semibold text-indigo-900" id="ttsUSD">$0.20</div>
                                    <div class="text-xs text-indigo-600" id="ttsKRW">₩270</div>
                                </div>
                            </div>
                            <p class="text-xs text-indigo-600 mt-1" id="ttsDetails">
                                50K 문자
                            </p>
                        </div>

                        <!-- 총 비용 -->
                        <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white rounded-lg p-6 mt-6">
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-bold">총 월 비용</span>
                                <div class="text-right">
                                    <div class="text-2xl font-bold" id="totalUSD">$93.49</div>
                                    <div class="text-gray-300" id="totalKRW">₩126,212</div>
                                </div>
                            </div>
                            <div class="mt-4 pt-4 border-t border-gray-600">
                                <div class="text-sm text-gray-300">
                                    <p>• 전화번호 임대료: 일일 과금 × 30일 (1개월) 기준</p>
                                    <p>• AI무제한 요금제: 음성서비스 $0.038/분 + 인/아웃바운드 통신비 별도</p>
                                    <p>• SMS/이메일 사용료 (별도)</p>
                                    <p>• 데이터 전송 비용 (별도)</p>
                                    <p>• CloudWatch 로그 비용 (별도)</p>
                                    <p>• 국제 통화료 (별도 요금 적용)</p>
                                    <p>• 본 예상 비용은 추정치로 추가 비용이 발생할 수도 있습니다.</p>
                                    <p>• 2025.07월 AWS 요금체계 기준</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 추가 정보 -->
            <div class="bg-gray-50 p-6 border-t">
                <h3 class="font-semibold text-gray-800 mb-3">[포함된 서비스]</h3>
                <div class="grid md:grid-cols-2 gap-4 text-sm text-gray-600">
                    <div>
                        <h4 class="font-medium text-gray-800 mb-1">AI무제한 요금제 구성 (서울리전 기준):</h4>
                        <ul class="space-y-1">
                            <li>• Connect Instance: 무료</li>
                            <li>• DID 번호: $0.0864/일</li>
                            <li>• Toll-free 번호: $0.70/일</li>
                            <li>• DID 인바운드: $0.002/분</li>
                            <li>• Toll-free 인바운드: $0.11/분</li>
                            <li>• 아웃바운드 (한국 내): $0.0376/분</li>
                            <li>• S3 Standard: $0.025/GB/월</li>
                            <li>• AI무제한 음성 서비스: $0.038/분</li>
                            <li>• Contact Lens, Amazon Q 등 AI기능 무제한 제공</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-800 mb-1">S3 자동 계산 기준:</h4>
                        <ul class="space-y-1">
                           <li>• 서울 리전 S3 Standard 요금 적용</li>
                            <li>• 녹취 파일 크기: 1MB/분 기준</li>
                            <li>• 평균 통화시간: 3분/콜 기준</li>
                            <li>• 총 통화시간 × 녹취 비율로 계산</li>
                            <li>• PUT 요청(파일 업로드) 비용 포함</li>
                            <li>• 1달 평균 녹취 용량 기준. 누적되는 녹취파일의 S3용량은 별도 계산 필요</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 요금 설정 - 한국(서울) 리전
        const rates = {
            instanceMonthly: 0, // USD per month (no base fee)
            didNumberDaily: 0.0864, // USD per day (Korea DID - 89% reduction applied)
            tollFreeNumberDaily: 0.70, // USD per day (Korea toll-free - 서울리전)
            didInboundTelephony: 0.002, // USD per minute (Korea DID inbound - 97% reduction applied)
            tollFreeInboundTelephony: 0.11, // USD per minute (Korea toll-free inbound)
            outboundTelephony: 0.0376, // USD per minute (outbound to Korea)
            aiUnlimitedVoice: 0.038, // USD per minute for AI unlimited voice service
            s3StandardStorage: 0.025, // USD per GB per month (Seoul region)
            s3PutRequests: 0.005, // USD per 1,000 PUT requests
            recordingFileSizeMB: 1, // MB per minute of recording
            pollyTTS: 4.00 // USD per 1 million characters
        };

        // 통화 포맷 함수
        function formatCurrency(amount) {
            return new Intl.NumberFormat('ko-KR', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2
            }).format(amount);
        }

        function formatKRW(usdAmount) {
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 1350;
            const krwAmount = usdAmount * exchangeRate;
            return new Intl.NumberFormat('ko-KR', {
                style: 'currency',
                currency: 'KRW',
                maximumFractionDigits: 0
            }).format(krwAmount);
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(num);
        }

        // 입력값 가져오기
        function getInputs() {
            return {
                inboundMinutes: parseFloat(document.getElementById('inboundMinutes').value) || 0,
                outboundMinutes: parseFloat(document.getElementById('outboundMinutes').value) || 0,
                didNumbers: parseFloat(document.getElementById('didNumbers').value) || 0,
                tollFreeNumbers: parseFloat(document.getElementById('tollFreeNumbers').value) || 0,
                recordingPercentage: parseFloat(document.getElementById('recordingPercentage').value) || 0,
                tollFreeInboundPercentage: parseFloat(document.getElementById('tollFreeInboundPercentage').value) || 0,
                ttsCharactersPerCall: parseFloat(document.getElementById('ttsCharactersPerCall').value) || 0,
                exchangeRate: parseFloat(document.getElementById('exchangeRate').value) || 1350
            };
        }

        // 비용 계산
        function calculateCosts() {
            const inputs = getInputs();

            // 전화번호 임대료 (일일 요금 × 30일)
            const didRental = inputs.didNumbers * rates.didNumberDaily * 30;
            const tollFreeRental = inputs.tollFreeNumbers * rates.tollFreeNumberDaily * 30;
            const numberRental = didRental + tollFreeRental;

            // 인바운드 통화료 (DID와 Toll-free 구분)
            const tollFreeInboundMinutes = inputs.inboundMinutes * (inputs.tollFreeInboundPercentage / 100);
            const didInboundMinutes = inputs.inboundMinutes - tollFreeInboundMinutes;
            const didInboundCost = didInboundMinutes * rates.didInboundTelephony;
            const tollFreeInboundCost = tollFreeInboundMinutes * rates.tollFreeInboundTelephony;
            const inboundTelephony = didInboundCost + tollFreeInboundCost;

            // 아웃바운드 통화료
            const outboundTelephony = inputs.outboundMinutes * rates.outboundTelephony;

            // AI 무제한 음성 요금 (총 통화 시간)
            const totalMinutes = inputs.inboundMinutes + inputs.outboundMinutes;
            const aiUnlimitedVoice = totalMinutes * rates.aiUnlimitedVoice;

            // S3 스토리지 비용 (자동 계산)
            // 녹취 파일 크기: 총 통화시간 × 녹취 비율 × 1MB/분
            const recordedMinutes = totalMinutes * (inputs.recordingPercentage / 100);
            const s3StorageGB = (recordedMinutes * rates.recordingFileSizeMB) / 1024; // MB를 GB로 변환
            const s3StorageCost = s3StorageGB * rates.s3StandardStorage;
            
            // S3 PUT 요청 비용 (녹취 파일 업로드)
            const averageCallDuration = 3; // 분
            const recordedCalls = recordedMinutes / averageCallDuration;
            const s3PutRequests = (recordedCalls / 1000) * rates.s3PutRequests;

            // TTS 비용 (인바운드 콜 수 × 콜당 평균 문자수)
            const inboundCalls = inputs.inboundMinutes / averageCallDuration;
            const totalTtsCharacters = inboundCalls * inputs.ttsCharactersPerCall;
            const tts = (totalTtsCharacters / 1000000) * rates.pollyTTS;

            const total = numberRental + inboundTelephony + outboundTelephony + aiUnlimitedVoice + s3StorageCost + s3PutRequests + tts;

            return {
                numberRental,
                inboundTelephony,
                outboundTelephony,
                aiUnlimitedVoice,
                s3StorageCost,
                s3PutRequests,
                tts,
                total,
                inputs,
                inboundCalls: Math.round(inboundCalls),
                totalTtsCharacters: Math.round(totalTtsCharacters),
                didInboundMinutes: Math.round(didInboundMinutes),
                tollFreeInboundMinutes: Math.round(tollFreeInboundMinutes),
                didInboundCost,
                tollFreeInboundCost,
                s3StorageGB: Math.round(s3StorageGB * 100) / 100, // 소수점 2자리
                recordedMinutes: Math.round(recordedMinutes),
                recordedCalls: Math.round(recordedCalls)
            };
        }

        // UI 업데이트
        function updateCalculations() {
            const costs = calculateCosts();
            const inputs = costs.inputs;

            // 총 통화 시간 업데이트
            document.getElementById('totalMinutes').textContent = formatNumber(inputs.inboundMinutes + inputs.outboundMinutes) + ' 분';

            // S3 자동 계산 표시 업데이트
            document.getElementById('s3StorageCalculated').textContent = costs.s3StorageGB + ' GB (자동 계산됨)';

            // 전화번호 임대료
            document.getElementById('numberRentalUSD').textContent = formatCurrency(costs.numberRental);
            document.getElementById('numberRentalKRW').textContent = formatKRW(costs.numberRental);
            document.getElementById('numberRentalDetails').textContent = `DID ${inputs.didNumbers}개 + Toll-free ${inputs.tollFreeNumbers}개 (월 30일 기준)`;

            // 인바운드 통화료
            document.getElementById('inboundTelephonyUSD').textContent = formatCurrency(costs.inboundTelephony);
            document.getElementById('inboundTelephonyKRW').textContent = formatKRW(costs.inboundTelephony);
            document.getElementById('inboundTelephonyDetails').textContent = `DID ${formatNumber(costs.didInboundMinutes)}분×$0.002 + Toll-free ${formatNumber(costs.tollFreeInboundMinutes)}분×$0.08`;

            // 아웃바운드 통화료
            document.getElementById('outboundTelephonyUSD').textContent = formatCurrency(costs.outboundTelephony);
            document.getElementById('outboundTelephonyKRW').textContent = formatKRW(costs.outboundTelephony);
            document.getElementById('outboundTelephonyDetails').textContent = `${formatNumber(inputs.outboundMinutes)}분 × $0.048/분 (한국 내)`;

            // AI무제한 음성 요금
            document.getElementById('aiUnlimitedVoiceUSD').textContent = formatCurrency(costs.aiUnlimitedVoice);
            document.getElementById('aiUnlimitedVoiceKRW').textContent = formatKRW(costs.aiUnlimitedVoice);
            document.getElementById('aiUnlimitedVoiceDetails').textContent = `${formatNumber(inputs.inboundMinutes + inputs.outboundMinutes)}분 × $0.038/분`;

            // S3 저장비용
            document.getElementById('s3StorageUSD').textContent = formatCurrency(costs.s3StorageCost + costs.s3PutRequests);
            document.getElementById('s3StorageKRW').textContent = formatKRW(costs.s3StorageCost + costs.s3PutRequests);
            document.getElementById('s3StorageDetails').textContent = `${costs.s3StorageGB}GB 저장 + ${formatNumber(costs.recordedCalls)}건 업로드 (${formatNumber(costs.recordedMinutes)}분 녹취)`;

            // TTS 비용
            document.getElementById('ttsUSD').textContent = formatCurrency(costs.tts);
            document.getElementById('ttsKRW').textContent = formatKRW(costs.tts);
            document.getElementById('ttsDetails').textContent = `${formatNumber(costs.inboundCalls)}콜 × ${inputs.ttsCharactersPerCall}자 = ${formatNumber(costs.totalTtsCharacters)}자`;

            // 총 비용
            document.getElementById('totalUSD').textContent = formatCurrency(costs.total);
            document.getElementById('totalKRW').textContent = formatKRW(costs.total);
        }

        // CSV 내보내기 함수
        function exportToCSV() {
            const costs = calculateCosts();
            const inputs = costs.inputs;
            const currentDate = new Date().toLocaleDateString('ko-KR');

            // CSV 데이터 구성
            let csvContent = '';
            
            // 헤더 정보
            csvContent += `Amazon Connect 비용 계산서\n`;
            csvContent += `계산 일시: ${currentDate}\n`;
            csvContent += `리전: 한국(서울)\n`;
            csvContent += `요금제: AI무제한 요금제\n`;
            csvContent += `환율: $1 = ₩${inputs.exchangeRate}\n\n`;

            // 1. 요금표 (계산 기준이 되는 단가들)
            csvContent += `== 요금표 (단가 정보) ==\n`;
            csvContent += `항목,단위,USD 단가,KRW 단가\n`;
            csvContent += `Connect Instance,월,${rates.instanceMonthly},${rates.instanceMonthly * inputs.exchangeRate}\n`;
            csvContent += `DID 번호 임대료,일,${rates.didNumberDaily},${rates.didNumberDaily * inputs.exchangeRate}\n`;
            csvContent += `Toll-free 번호 임대료,일,${rates.tollFreeNumberDaily},${rates.tollFreeNumberDaily * inputs.exchangeRate}\n`;
            csvContent += `DID 인바운드 통화료,분,${rates.didInboundTelephony},${rates.didInboundTelephony * inputs.exchangeRate}\n`;
            csvContent += `Toll-free 인바운드 통화료,분,${rates.tollFreeInboundTelephony},${rates.tollFreeInboundTelephony * inputs.exchangeRate}\n`;
            csvContent += `아웃바운드 통화료 (한국내),분,${rates.outboundTelephony},${rates.outboundTelephony * inputs.exchangeRate}\n`;
            csvContent += `AI무제한 음성 서비스,분,${rates.aiUnlimitedVoice},${rates.aiUnlimitedVoice * inputs.exchangeRate}\n`;
            csvContent += `S3 Standard 스토리지,GB/월,${rates.s3StandardStorage},${rates.s3StandardStorage * inputs.exchangeRate}\n`;
            csvContent += `S3 PUT 요청,1000건,${rates.s3PutRequests},${rates.s3PutRequests * inputs.exchangeRate}\n`;
            csvContent += `TTS (Polly),백만자,${rates.pollyTTS},${rates.pollyTTS * inputs.exchangeRate}\n\n`;

            // 2. 사용량 정보
            csvContent += `== 입력된 사용량 ==\n`;
            csvContent += `항목,수량,단위\n`;
            csvContent += `인바운드 통화시간,${inputs.inboundMinutes},분/월\n`;
            csvContent += `아웃바운드 통화시간,${inputs.outboundMinutes},분/월\n`;
            csvContent += `총 통화시간,${inputs.inboundMinutes + inputs.outboundMinutes},분/월\n`;
            csvContent += `DID 번호 개수,${inputs.didNumbers},개\n`;
            csvContent += `Toll-free 번호 개수,${inputs.tollFreeNumbers},개\n`;
            csvContent += `녹취 비율,${inputs.recordingPercentage},%\n`;
            csvContent += `Toll-free 인바운드 비율,${inputs.tollFreeInboundPercentage},%\n`;
            csvContent += `TTS 평균 문자수 (콜당),${inputs.ttsCharactersPerCall},자\n`;
            csvContent += `S3 저장용량 (계산됨),${costs.s3StorageGB},GB\n\n`;

            // 3. 예상 월 비용
            csvContent += `== 예상 월 비용 ==\n`;
            csvContent += `비용 항목,세부 내용,USD 금액,KRW 금액\n`;
            csvContent += `전화번호 임대료,"DID ${inputs.didNumbers}개×${rates.didNumberDaily}×30일 + Toll-free ${inputs.tollFreeNumbers}개×${rates.tollFreeNumberDaily}×30일",${costs.numberRental.toFixed(2)},${(costs.numberRental * inputs.exchangeRate).toFixed(0)}\n`;
            csvContent += `인바운드 통화료,"DID ${costs.didInboundMinutes}분×${rates.didInboundTelephony} + Toll-free ${costs.tollFreeInboundMinutes}분×${rates.tollFreeInboundTelephony}",${costs.inboundTelephony.toFixed(2)},${(costs.inboundTelephony * inputs.exchangeRate).toFixed(0)}\n`;
            csvContent += `아웃바운드 통화료,"${inputs.outboundMinutes}분×${rates.outboundTelephony}",${costs.outboundTelephony.toFixed(2)},${(costs.outboundTelephony * inputs.exchangeRate).toFixed(0)}\n`;
            csvContent += `AI무제한 음성 요금,"${inputs.inboundMinutes + inputs.outboundMinutes}분×${rates.aiUnlimitedVoice}",${costs.aiUnlimitedVoice.toFixed(2)},${(costs.aiUnlimitedVoice * inputs.exchangeRate).toFixed(0)}\n`;
            csvContent += `S3 저장비용,"${costs.s3StorageGB}GB×${rates.s3StandardStorage} + ${costs.recordedCalls}건 업로드",${(costs.s3StorageCost + costs.s3PutRequests).toFixed(2)},${((costs.s3StorageCost + costs.s3PutRequests) * inputs.exchangeRate).toFixed(0)}\n`;
            csvContent += `TTS (Polly),"${costs.inboundCalls}콜×${inputs.ttsCharactersPerCall}자=${costs.totalTtsCharacters}자",${costs.tts.toFixed(2)},${(costs.tts * inputs.exchangeRate).toFixed(0)}\n\n`;

            // 4. 총 비용
            csvContent += `== 총 예상 비용 ==\n`;
            csvContent += `구분,USD 금액,KRW 금액\n`;
            csvContent += `월 총 비용,${costs.total.toFixed(2)},${(costs.total * inputs.exchangeRate).toFixed(0)}\n\n`;

            // 5. 주의사항
            csvContent += `== 주의사항 ==\n`;
            csvContent += `항목,내용\n`;
            csvContent += `전화번호 임대료,일일 과금 × 30일 (1개월) 기준\n`;
            csvContent += `AI무제한 요금제,음성서비스 $0.038/분 + 인/아웃바운드 통신비 별도\n`;
            csvContent += `별도 비용,SMS/이메일 사용료 별도\n`;
            csvContent += `별도 비용,데이터 전송 비용 별도\n`;
            csvContent += `별도 비용,CloudWatch 로그 비용 별도\n`;
            csvContent += `별도 비용,국제 통화료 별도 요금 적용\n`;
            csvContent += `면책사항,본 예상 비용은 추정치로 추가 비용이 발생할 수도 있습니다\n`;
            csvContent += `기준 날짜,2025.07월 AWS 요금체계 기준\n`;
            csvContent += `리전 기준,한국(서울) 리전 ap-northeast-2\n`;
            csvContent += `한국 요금 할인,DID 번호 89% 할인 / DID 인바운드 97% 할인 적용\n`;

            // CSV 파일 다운로드
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `Amazon_Connect_비용계산서_서울리전_${currentDate.replace(/\./g, '_').replace(/\s/g, '_')}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 초기 계산 실행
        document.addEventListener('DOMContentLoaded', function() {
            updateCalculations();
        });
    </script>
</body>
</html>